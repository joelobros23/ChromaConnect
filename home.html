<!DOCTYPE html>
<html lang='en'>
<head>
	<meta charset='UTF-8'>
	<meta name='viewport' content='width=device-width, initial-scale=1.0'>
	<title>ChromaConnect</title>
	<script src='https://cdn.tailwindcss.com'></script>
	<link rel='stylesheet' href='assets/css/style.css'>
</head>
<body class='bg-gray-100'>
	<nav class='bg-white p-4 shadow-md'>
		<div class='container mx-auto flex justify-between items-center'>
			<a href='home.html' class='text-2xl font-bold text-indigo-600'>ChromaConnect</a>
			<div class='flex items-center space-x-4'>
				<a href='profile.html' class='hover:text-indigo-600'>Profile</a>
				<a href='search.html' class='hover:text-indigo-600'>Search</a>
				<a href='friends.html' class='hover:text-indigo-600'>Friends</a>
				<button id='logoutBtn' class='bg-indigo-500 text-white py-2 px-4 rounded hover:bg-indigo-600'>Logout</button>
			</div>
		</div>
	</nav>

	<div class='container mx-auto mt-8'>
		<div class='grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4' id='postsContainer'>
			<!-- Posts will be dynamically added here -->
		</div>
	</div>

	<script src='assets/js/main.js'></script>
	<script>
		document.addEventListener('DOMContentLoaded', function() {
			const postsContainer = document.getElementById('postsContainer');

			function fetchPosts() {
				fetch('api/get_posts.php')
					.then(response => response.json())
					.then(data => {
						if (data.success) {
							postsContainer.innerHTML = ''; // Clear existing posts
							data.posts.forEach(post => {
								const postElement = document.createElement('div');
								postElement.className = 'bg-white rounded-lg shadow-md p-4';
								postElement.innerHTML = `
									<div class='flex items-center mb-2'>
										<img src="${post.profile_picture ? post.profile_picture : 'assets/images/default_profile.png'}" alt="Profile Picture" class="w-8 h-8 rounded-full mr-2">
										<a href="profile.html?user_id=${post.user_id}" class="font-bold">${post.username}</a>
									</div>
									<img src="${post.image_path}" alt="Post Image" class="mb-2 rounded-md">
									<p class='text-gray-700 mb-2'>${post.caption}</p>
									<div class="flex items-center justify-between">
										<div>
											<button class="likeButton text-blue-500 hover:text-blue-700 mr-2" data-post-id="${post.id}">Like</button>
											<button class="commentButton text-green-500 hover:text-green-700" data-post-id="${post.id}">Comment</button>
										</div>
										<p class="text-gray-500 text-sm">${post.created_at}</p>
									</div>
								`;
								postsContainer.appendChild(postElement);
							});

							// Add event listeners to like and comment buttons
							const likeButtons = document.querySelectorAll('.likeButton');
							likeButtons.forEach(button => {
								button.addEventListener('click', function() {
									const postId = this.dataset.postId;
									// Implement like functionality here (call API)
									console.log('Like button clicked for post ID:', postId);
									likePost(postId);
								});
							});

							const commentButtons = document.querySelectorAll('.commentButton');
							commentButtons.forEach(button => {
								button.addEventListener('click', function() {
									const postId = this.dataset.postId;
									// Implement comment functionality here (show comment form/modal)
									console.log('Comment button clicked for post ID:', postId);
									// For now, just redirect to a comment page (you might want a modal)
									window.location.href = `comments.html?post_id=${postId}`;
								});
							});
						} else {
							console.error('Failed to fetch posts:', data.message);
							postsContainer.innerHTML = '<p class="text-red-500">Failed to load posts.</p>';
						}
					})
					.catch(error => {
						console.error('Error fetching posts:', error);
						postsContainer.innerHTML = '<p class="text-red-500">Error loading posts.</p>';
					});
			}

			function likePost(postId) {
				fetch('api/like_post.php', {
					method: 'POST',
					headers: {
						'Content-Type': 'application/x-www-form-urlencoded'
					},
					body: 'post_id=' + encodeURIComponent(postId)
				})
				.then(response => response.json())
				.then(data => {
					if (data.success) {
						console.log('Post liked successfully');
						// Optionally, update the UI to reflect the like
						fetchPosts(); // Refresh posts to reflect the updated like status
					} else {
						console.error('Failed to like post:', data.message);
					}
				})
				.catch(error => {
					console.error('Error liking post:', error);
				});
			}

			// Initial fetch of posts
			fetchPosts();

			// Logout functionality
			document.getElementById('logoutBtn').addEventListener('click', function() {
				fetch('api/logout.php')
					.then(response => response.json())
					.then(data => {
						if (data.success) {
							window.location.href = 'index.html';
						} else {
							alert('Logout failed: ' + data.message);
						}
					})
					.catch(error => {
						console.error('Error during logout:', error);
						alert('Logout failed. Please try again.');
					});
			});

		});
	</script>
</body>
</html>