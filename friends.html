<!DOCTYPE html>
<html lang='en'>
<head>
	<meta charset='UTF-8'>
	<meta name='viewport' content='width=device-width, initial-scale=1.0'>
	<title>ChromaConnect - Friends</title>
	<script src='https://cdn.tailwindcss.com'></script>
	<link rel='stylesheet' href='assets/css/style.css'>
</head>
<body class='bg-gray-100'>
	<nav class="bg-white p-4 shadow-md">
        <div class="container mx-auto flex justify-between items-center">
            <a href="home.html" class="text-2xl font-bold text-indigo-600">ChromaConnect</a>
            <div class="space-x-4">
                <a href="home.html" class="hover:text-indigo-600">Home</a>
                <a href="profile.html" class="hover:text-indigo-600">Profile</a>
                <a href="friends.html" class="hover:text-indigo-600">Friends</a>
                <a href="search.html" class="hover:text-indigo-600">Search</a>
                <button id="logoutButton" class="bg-indigo-500 text-white py-2 px-4 rounded hover:bg-indigo-600">Logout</button>
            </div>
        </div>
    </nav>

	<div class='container mx-auto mt-8'>
		<h1 class='text-2xl font-semibold mb-4'>Friends</h1>

		<div id='friendsList' class='grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4'>
			<!-- Friend cards will be dynamically added here -->
		</div>
	</div>

	<script src='assets/js/auth.js'></script>
	<script>
		document.addEventListener('DOMContentLoaded', () => {
			const friendsListContainer = document.getElementById('friendsList');

			// Function to fetch and display friends
			const fetchFriends = async () => {
				try {
					const response = await fetch('api/get_friends.php', {
						method: 'GET',
						headers: {
							'Content-Type': 'application/json'
						}
					});

					if (!response.ok) {
						throw new Error(`HTTP error! status: ${response.status}`);
					}

					const data = await response.json();

					if (data.success) {
						const friends = data.friends;

						if (friends.length === 0) {
							friendsListContainer.innerHTML = '<p>No friends yet.</p>';
							return;
						}

						// Create friend cards
						let friendsHTML = '';
						friends.forEach(friend => {
							friendsHTML += `
								<div class='bg-white rounded-lg shadow-md p-4'>
									<img src='${friend.profile_picture ? friend.profile_picture : 'assets/images/default_profile.png'}' alt='${friend.username}' class='w-20 h-20 rounded-full mx-auto mb-2 object-cover'>
									<h2 class='text-lg font-semibold text-center'>${friend.username}</h2>
									<p class='text-gray-600 text-center'>${friend.bio ? friend.bio.substring(0, 50) + '...' : 'No bio available.'}</p>
									<a href='profile.html?user_id=${friend.id}' class='block mt-2 text-indigo-500 hover:text-indigo-700 text-center'>View Profile</a>
								</div>
							`;
						});

						friendsListContainer.innerHTML = friendsHTML;

					} else {
						friendsListContainer.innerHTML = `<p class='text-red-500'>Error: ${data.message}</p>`;
					}

				} catch (error) {
					console.error('Error fetching friends:', error);
					friendsListContainer.innerHTML = '<p class="text-red-500">Failed to load friends.</p>';
				}
			};

			fetchFriends();
		});

		document.getElementById('logoutButton').addEventListener('click', logout);
	</script>
</body>
</html>